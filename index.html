<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Rondon√≥polis Store - Chat & Servi√ßos</title>
  
  <!-- RESPONSIVO -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff0000">
  <meta name="description" content="Rondon√≥polis Store - Servi√ßos de inform√°tica e chat comunit√°rio">
  
  <!-- IOS -->
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  <!-- Font Awesome para √≠cones -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    :root {
      --primary-color: #ff0000;
      --secondary-color: #2c3e50;
      --whatsapp-green: #25D366;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #0d0d0d;
      color: white;
      min-height: 100vh;
    }
    
    /* Layout para PC */
    .pc-layout {
      display: flex;
      min-height: 100vh;
    }
    
    /* Layout para Mobile */
    .mobile-layout {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    /* Painel lateral para PC */
    .sidebar-pc {
      width: 350px;
      background-color: #1a1a1a;
      border-right: 1px solid #333;
      display: flex;
      flex-direction: column;
    }
    
    /* Conte√∫do principal */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    /* Banner de servi√ßos */
    .services-banner {
      background: #1a1a1a;
      color: white;
      padding: 15px;
      text-align: center;
      border-bottom: 3px solid var(--primary-color);
      position: relative;
      z-index: 10;
      transition: opacity 0.5s ease-in-out;
    }
    
    .services-banner.hidden {
      opacity: 0;
      height: 0;
      padding: 0;
      overflow: hidden;
      border-bottom: none;
    }
    
    .services-banner h2 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.3rem;
    }
    
    .services-banner p {
      margin: 5px 0;
      font-size: 0.95rem;
      line-height: 1.4;
    }
    
    .services-banner .highlight {
      color: #ffcc00;
      font-weight: bold;
    }
    
    /* Container do bot√£o do WhatsApp */
    .whatsapp-container {
      background-color: #1a1a1a;
      padding: 10px 15px;
      text-align: center;
      border-bottom: 2px solid var(--whatsapp-green);
      z-index: 9;
    }
    
    .whatsapp-button {
      background-color: var(--whatsapp-green);
      color: white;
      border: none;
      border-radius: 50px;
      padding: 12px 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      margin: 5px 0;
    }
    
    .whatsapp-button:hover {
      opacity: 0.9;
    }
    
    .whatsapp-button i {
      font-size: 1.5rem;
    }
    
    .whatsapp-label {
      color: #ffcc00;
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 8px;
      display: block;
    }
    
    /* Vers√£o mobile */
    .mobile .whatsapp-button {
      padding: 10px 20px;
      font-size: 14px;
    }
    
    /* Bot√£o flutuante WhatsApp */
    .whatsapp-float {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 1000;
    }
    
    .whatsapp-float-button {
      background-color: var(--whatsapp-green);
      color: white;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-size: 1.8rem;
    }
    
    /* Cabe√ßalho do chat */
    .chat-header {
      background-color: var(--secondary-color);
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .chat-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .chat-title h1 {
      font-size: 1.5rem;
    }
    
    .mobile .chat-title h1 {
      font-size: 1.2rem;
    }
    
    .controls {
      display: flex;
      gap: 10px;
    }
    
    .control-btn {
      background: var(--primary-color);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }
    
    .mobile .control-btn {
      width: 35px;
      height: 35px;
      font-size: 1rem;
    }
    
    /* PWA Installer */
    .pwa-installer {
      padding: 20px;
      text-align: center;
      background-color: #0d0d0d;
      border-bottom: 1px solid #333;
    }
    
    .pwa-installer h3 {
      color: var(--primary-color);
      margin-bottom: 10px;
      font-size: 1.2rem;
    }
    
    .pwa-installer p {
      color: #ccc;
      margin-bottom: 15px;
      font-size: 0.9rem;
    }
    
    .btn {
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      width: 100%;
    }
    
    .btn-install {
      background: var(--primary-color);
      color: white;
    }
    
    /* Perfil do usu√°rio */
    .user-profile {
      padding: 20px;
      background-color: #222;
      border-bottom: 1px solid #333;
    }
    
    .profile-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .profile-pic-container {
      position: relative;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid var(--primary-color);
      cursor: pointer;
      background-color: #333;
    }
    
    .mobile .profile-pic-container {
      width: 60px;
      height: 60px;
    }
    
    .profile-pic {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .profile-pic-overlay {
      position: absolute;
      bottom: 0;
      background: rgba(0,0,0,0.7);
      color: white;
      width: 100%;
      text-align: center;
      padding: 5px;
      font-size: 0.8rem;
    }
    
    .profile-info h3 {
      font-size: 1.2rem;
      margin-bottom: 5px;
    }
    
    .mobile .profile-info h3 {
      font-size: 1rem;
    }
    
    .profile-info .status {
      font-size: 0.9rem;
      color: #2ecc71;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .profile-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .form-group label {
      font-size: 0.9rem;
      font-weight: 600;
      color: #ccc;
    }
    
    .form-group input, .form-group select {
      padding: 10px;
      border: 1px solid #444;
      border-radius: 5px;
      font-size: 0.95rem;
      background-color: #333;
      color: white;
    }
    
    .save-profile {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      margin-top: 10px;
    }
    
    /* Lista de usu√°rios */
    .users-list {
      padding: 20px;
      flex: 1;
      overflow-y: auto;
    }
    
    .users-list h3 {
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #333;
      color: #ccc;
    }
    
    .empty-users-message {
      text-align: center;
      padding: 30px 20px;
      color: #888;
      font-style: italic;
    }
    
    .user-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 8px;
      background-color: #222;
    }
    
    .user-item .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }
    
    .mobile .user-item .avatar {
      width: 35px;
      height: 35px;
    }
    
    .user-item .user-info {
      flex: 1;
    }
    
    .user-item .user-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: white;
    }
    
    .private-chat-btn {
      background: transparent;
      border: none;
      color: var(--primary-color);
      cursor: pointer;
      font-size: 1.2rem;
    }
    
    /* √Årea do chat */
    .chat-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      background-color: #111;
    }
    
    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background-color: #0a0a0a;
    }
    
    .message {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    .message.own-message {
      flex-direction: row-reverse;
    }
    
    .message-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      align-self: flex-end;
    }
    
    .message-content {
      max-width: 70%;
      display: flex;
      flex-direction: column;
    }
    
    .message.own-message .message-content {
      align-items: flex-end;
    }
    
    .message-sender {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 5px;
      color: #aaa;
    }
    
    .message-bubble {
      padding: 12px 15px;
      border-radius: 18px;
      background-color: #222;
      color: white;
    }
    
    .message.own-message .message-bubble {
      background-color: #2a2a2a;
    }
    
    /* √Årea de entrada de mensagens */
    .chat-input-area {
      padding: 15px;
      border-top: 1px solid #333;
      background-color: #111;
    }
    
    .input-container {
      display: flex;
      gap: 10px;
      align-items: flex-end;
    }
    
    .emoji-btn, .image-btn, .send-btn {
      background: transparent;
      border: none;
      font-size: 1.5rem;
      color: #aaa;
      cursor: pointer;
      padding: 5px;
    }
    
    .send-btn {
      color: var(--primary-color);
    }
    
    .message-input {
      flex: 1;
      padding: 12px 15px;
      border: 1px solid #444;
      border-radius: 25px;
      resize: none;
      font-size: 1rem;
      background-color: #222;
      color: white;
    }
    
    .message-input:focus {
      outline: none;
      border-color: var(--primary-color);
    }
    
    /* Menu m√≥vel */
    .mobile-menu {
      display: flex;
      justify-content: space-around;
      background-color: #1a1a1a;
      border-top: 1px solid #333;
      padding: 10px;
    }
    
    .mobile-menu-btn {
      background: transparent;
      border: none;
      color: #aaa;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      padding: 10px;
      flex: 1;
      font-size: 0.8rem;
    }
    
    .mobile-menu-btn.active {
      color: var(--primary-color);
    }
    
    .mobile-menu-btn i {
      font-size: 1.2rem;
    }
    
    /* Classe para mensagens do sistema */
    .system-message {
      text-align: center;
      margin: 15px 0;
      color: #777;
      font-size: 0.9rem;
      font-style: italic;
    }
    
    /* Esconder elementos n√£o necess√°rios */
    .mobile .sidebar-pc {
      display: none;
    }
    
    .mobile .pc-only {
      display: none;
    }
    
    .pc .mobile-only {
      display: none;
    }
    
    /* P√°ginas para mobile */
    .mobile-page {
      display: none;
      flex: 1;
      overflow-y: auto;
    }
    
    .mobile-page.active {
      display: flex;
      flex-direction: column;
    }
    
    /* Input oculto para imagem */
    #imageUpload {
      display: none;
    }
    
    @media (max-width: 768px) {
      .pc-layout {
        display: none;
      }
      .mobile-layout {
        display: flex;
      }
    }
    
    @media (min-width: 769px) {
      .mobile-layout {
        display: none;
      }
      .pc-layout {
        display: flex;
      }
    }
  </style>
</head>

<body>
  <!-- Layout para PC -->
  <div class="pc-layout">
    <!-- Painel lateral (PC) -->
    <div class="sidebar-pc">
      <!-- PWA Installer -->
      <div class="pwa-installer pc-only">
        <h3>Mundo Store App</h3>
        <p>Instale nosso aplicativo!</p>
        <button class="btn btn-install" id="installBtnPc">
          <i class="fas fa-download"></i> Instalar App
        </button>
      </div>
      
      <!-- Perfil do usu√°rio -->
      <div class="user-profile">
        <div class="profile-header">
          <div class="profile-pic-container" id="profilePicContainer">
            <img src="https://ui-avatars.com/api/?name=Usuario&background=ff0000&color=fff" alt="Foto de perfil" class="profile-pic" id="profilePic">
            <div class="profile-pic-overlay">Alterar</div>
          </div>
          <div class="profile-info">
            <h3 id="userNameDisplay">Usu√°rio</h3>
            <div class="status">
              <i class="fas fa-circle"></i> Offline
            </div>
          </div>
        </div>
        
        <form class="profile-form" id="profileForm">
          <div class="form-group">
            <label for="userName">Nome/Nickname:</label>
            <input type="text" id="userName" required minlength="3" placeholder="Digite seu nome">
          </div>
          
          <div class="form-group">
            <label for="userAge">Idade (min 16):</label>
            <input type="number" id="userAge" required min="16" max="100" value="18">
          </div>
          
          <div class="form-group">
            <label for="userGender">G√™nero:</label>
            <select id="userGender">
              <option value="masculino">Masculino</option>
              <option value="feminino">Feminino</option>
              <option value="outro">Outro</option>
              <option value="prefiro-nao-dizer">Prefiro n√£o dizer</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="userStatus">Estado Civil:</label>
            <select id="userStatus">
              <option value="solteiro">Solteiro(a)</option>
              <option value="casado">Casado(a)</option>
              <option value="divorciado">Divorciado(a)</option>
              <option value="viuvo">Vi√∫vo(a)</option>
              <option value="uniao-estavel">Uni√£o Est√°vel</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="userNeighborhood">Bairro (Rondon√≥polis):</label>
            <input type="text" id="userNeighborhood" placeholder="Ex: Vila Aurora">
          </div>
          
          <button type="submit" class="save-profile">Salvar Perfil</button>
        </form>
      </div>
      
      <!-- Lista de usu√°rios -->
      <div class="users-list">
        <h3>Usu√°rios Online (<span id="onlineCount">0</span>)</h3>
        <div id="usersList">
          <div class="empty-users-message">
            <i class="fas fa-users-slash"></i>
            <p>A sala est√° vazia. Seja o primeiro a entrar!</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Conte√∫do principal (PC) -->
    <div class="main-content">
      <!-- Banner de servi√ßos -->
      <div class="services-banner" id="servicesBanner">
        <h2>üíª SERVI√áOS PROFISSIONAIS</h2>
        <p><strong>FORMATA√á√ÉO COMPUTADORES R$80,00</strong></p>
        <p>‚úÖ INSTALA√á√ÉO WINDOWS 10/11 PRO + OFFICE ATIVADO</p>
        <p>‚úÖ CLIENTE TRAZ E J√Å ESPERA NO LOCAL!</p>
        <p>‚úÖ ATENDO TODOS OS DIAS E FERIADOS (RONDON√ìPOLIS)</p>
        <p>‚úÖ SUPORTE REMOTO 24 HORAS QUALQUER CIDADE <span class="highlight">R$40,00</span></p>
        <p>‚úÖ INSTALA√á√ÉO OFFICE ATIVADO</p>
        <p>‚úÖ ATIVA√á√ÉO WINDOWS E OFFICE</p>
      </div>
      
      <!-- Container do bot√£o WhatsApp -->
      <div class="whatsapp-container">
        <div class="whatsapp-label">CLIQUE AQUI PARA CHAMAR NO WHATSAPP</div>
        <a href="https://wa.link/rloc2t" target="_blank" class="whatsapp-button">
          <i class="fab fa-whatsapp"></i>
          Falar no WhatsApp
        </a>
      </div>
      
      <!-- √Årea do chat -->
      <div class="chat-area">
        <!-- Cabe√ßalho do chat -->
        <header class="chat-header">
          <div class="chat-title">
            <i class="fas fa-comments"></i>
            <h1>RONDON√ìPOLIS STORE CHAT</h1>
          </div>
          <div class="controls">
            <button class="control-btn" id="fullscreenBtn" title="Tela cheia">
              <i class="fas fa-expand"></i>
            </button>
          </div>
        </header>
        
        <!-- Mensagens do chat -->
        <div class="chat-messages" id="chatMessages">
          <div class="system-message">
            Bem-vindo ao chat da Rondon√≥polis Store! Salve seu perfil ao lado para come√ßar a conversar.
          </div>
        </div>
        
        <!-- √Årea de entrada de mensagens -->
        <div class="chat-input-area">
          <div class="input-container">
            <button class="emoji-btn" id="emojiBtn" title="Emojis">
              <i class="far fa-smile"></i>
            </button>
            
            <textarea class="message-input" id="messageInput" placeholder="Digite sua mensagem..." rows="1"></textarea>
            
            <button class="send-btn" id="sendBtn" title="Enviar mensagem">
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Layout para Mobile -->
  <div class="mobile-layout">
    <!-- Banner de servi√ßos -->
    <div class="services-banner" id="servicesBannerMobile">
      <h2>üíª SERVI√áOS PROFISSIONAIS</h2>
      <p><strong>FORMATA√á√ÉO COMPUTADORES R$80,00</strong></p>
      <p>‚úÖ INSTALA√á√ÉO WINDOWS 10/11 PRO + OFFICE ATIVADO</p>
    </div>
    
    <!-- Container do bot√£o WhatsApp -->
    <div class="whatsapp-container">
      <div class="whatsapp-label">CLIQUE AQUI PARA CHAMAR NO WHATSAPP</div>
      <a href="https://wa.link/rloc2t" target="_blank" class="whatsapp-button">
        <i class="fab fa-whatsapp"></i>
        Falar no WhatsApp
      </a>
    </div>
    
    <!-- PWA Installer para mobile -->
    <div class="pwa-installer mobile-only">
      <h3>Mundo Store App</h3>
      <p>Instale nosso aplicativo!</p>
      <button class="btn btn-install" id="installBtnMobile">
        <i class="fas fa-download"></i> Instalar App
      </button>
    </div>
    
    <!-- P√°ginas para mobile -->
    <div class="mobile-page active" id="mobileChatPage">
      <!-- Cabe√ßalho do chat -->
      <header class="chat-header">
        <div class="chat-title">
          <i class="fas fa-comments"></i>
          <h1>RONDON√ìPOLIS STORE</h1>
        </div>
        <div class="controls">
          <button class="control-btn" id="fullscreenBtnMobile">
            <i class="fas fa-expand"></i>
          </button>
        </div>
      </header>
      
      <!-- Mensagens do chat -->
      <div class="chat-messages" id="chatMessagesMobile">
        <div class="system-message">
          Bem-vindo! V√° para a p√°gina de Perfil para come√ßar.
        </div>
      </div>
    </div>
    
    <!-- P√°gina de perfil (mobile) -->
    <div class="mobile-page" id="mobileProfilePage">
      <div class="chat-header">
        <div class="chat-title">
          <i class="fas fa-user-circle"></i>
          <h1>MEU PERFIL</h1>
        </div>
      </div>
      
      <div class="user-profile" style="flex: 1;">
        <div class="profile-header">
          <div class="profile-pic-container" id="profilePicContainerMobile">
            <img src="https://ui-avatars.com/api/?name=Usuario&background=ff0000&color=fff" alt="Foto de perfil" class="profile-pic" id="profilePicMobile">
            <div class="profile-pic-overlay">Alterar</div>
          </div>
          <div class="profile-info">
            <h3 id="userNameDisplayMobile">Usu√°rio</h3>
            <div class="status">
              <i class="fas fa-circle"></i> Offline
            </div>
          </div>
        </div>
        
        <form class="profile-form" id="profileFormMobile">
          <div class="form-group">
            <label for="userNameMobile">Nome/Nickname:</label>
            <input type="text" id="userNameMobile" required minlength="3" placeholder="Digite seu nome">
          </div>
          
          <div class="form-group">
            <label for="userAgeMobile">Idade (min 16):</label>
            <input type="number" id="userAgeMobile" required min="16" max="100" value="18">
          </div>
          
          <div class="form-group">
            <label for="userGenderMobile">G√™nero:</label>
            <select id="userGenderMobile">
              <option value="masculino">Masculino</option>
              <option value="feminino">Feminino</option>
              <option value="outro">Outro</option>
              <option value="prefiro-nao-dizer">Prefiro n√£o dizer</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="userStatusMobile">Estado Civil:</label>
            <select id="userStatusMobile">
              <option value="solteiro">Solteiro(a)</option>
              <option value="casado">Casado(a)</option>
              <option value="divorciado">Divorciado(a)</option>
              <option value="viuvo">Vi√∫vo(a)</option>
              <option value="uniao-estavel">Uni√£o Est√°vel</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="userNeighborhoodMobile">Bairro (Rondon√≥polis):</label>
            <input type="text" id="userNeighborhoodMobile" placeholder="Ex: Vila Aurora">
          </div>
          
          <button type="submit" class="save-profile">Salvar Perfil</button>
        </form>
      </div>
    </div>
    
    <!-- P√°gina de usu√°rios (mobile) -->
    <div class="mobile-page" id="mobileUsersPage">
      <div class="chat-header">
        <div class="chat-title">
          <i class="fas fa-users"></i>
          <h1>USU√ÅRIOS ONLINE</h1>
        </div>
      </div>
      
      <div class="users-list" style="flex: 1;">
        <div id="usersListMobile">
          <div class="empty-users-message">
            <i class="fas fa-users-slash"></i>
            <p>A sala est√° vazia. Seja o primeiro a entrar!</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- √Årea de entrada de mensagens (mobile) -->
    <div class="chat-input-area" id="mobileChatInput">
      <div class="input-container">
        <textarea class="message-input" id="messageInputMobile" placeholder="Digite sua mensagem..." rows="1"></textarea>
        <button class="send-btn" id="sendBtnMobile">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
    
    <!-- Menu inferior (mobile) -->
    <div class="mobile-menu">
      <button class="mobile-menu-btn active" data-page="chat">
        <i class="fas fa-comments"></i>
        <span>Chat</span>
      </button>
      <button class="mobile-menu-btn" data-page="users">
        <i class="fas fa-users"></i>
        <span>Usu√°rios</span>
      </button>
      <button class="mobile-menu-btn" data-page="profile">
        <i class="fas fa-user-circle"></i>
        <span>Perfil</span>
      </button>
    </div>
  </div>
  
  <!-- Bot√£o flutuante do WhatsApp -->
  <a href="https://wa.link/rloc2t" target="_blank" class="whatsapp-float">
    <div class="whatsapp-float-button">
      <i class="fab fa-whatsapp"></i>
    </div>
  </a>
  
  <!-- Input oculto para selecionar imagem -->
  <input type="file" id="imageUpload" accept="image/*">
  
  <script>
    // Dados do usu√°rio
    let currentUser = {
      id: 'user_' + Math.random().toString(36).substr(2, 9),
      name: "Usu√°rio",
      age: 18,
      gender: "masculino",
      status: "solteiro",
      neighborhood: "",
      avatar: "https://ui-avatars.com/api/?name=Usuario&background=ff0000&color=fff",
      online: false
    };
    
    let users = [];
    let hasUserJoined = false;
    
    // Elementos do DOM
    let chatMessages, messageInput, sendBtn, profileForm;
    let isMobile = window.innerWidth <= 768;
    
    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
      setupDevice();
      setupEventListeners();
      loadProfile();
      startBannerAnimation();
      setupPWA();
      
      // Adicionar mensagem inicial
      addSystemMessage("Bem-vindo ao chat da Rondon√≥polis Store!");
      addSystemMessage("Preencha seu perfil para come√ßar a conversar.");
    });
    
    // Configurar dispositivo
    function setupDevice() {
      if (isMobile) {
        document.querySelector('.pc-layout').style.display = 'none';
        document.querySelector('.mobile-layout').style.display = 'flex';
        chatMessages = document.getElementById('chatMessagesMobile');
        messageInput = document.getElementById('messageInputMobile');
        sendBtn = document.getElementById('sendBtnMobile');
        profileForm = document.getElementById('profileFormMobile');
      } else {
        document.querySelector('.mobile-layout').style.display = 'none';
        document.querySelector('.pc-layout').style.display = 'flex';
        chatMessages = document.getElementById('chatMessages');
        messageInput = document.getElementById('messageInput');
        sendBtn = document.getElementById('sendBtn');
        profileForm = document.getElementById('profileForm');
      }
    }
    
    // Configurar eventos
    function setupEventListeners() {
      // Enviar mensagem
      sendBtn.addEventListener('click', sendMessage);
      messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });
      
      // Salvar perfil
      profileForm.addEventListener('submit', function(e) {
        e.preventDefault();
        saveProfile();
      });
      
      // Alterar foto de perfil
      const profilePicContainers = document.querySelectorAll('.profile-pic-container');
      profilePicContainers.forEach(container => {
        container.addEventListener('click', function() {
          document.getElementById('imageUpload').click();
        });
      });
      
      // Upload de imagem
      document.getElementById('imageUpload').addEventListener('change', function(e) {
        if (e.target.files && e.target.files[0]) {
          const reader = new FileReader();
          reader.onload = function(event) {
            // Atualizar todas as fotos de perfil
            document.querySelectorAll('.profile-pic').forEach(img => {
              img.src = event.target.result;
            });
            currentUser.avatar = event.target.result;
            localStorage.setItem('userAvatar', event.target.result);
          };
          reader.readAsDataURL(e.target.files[0]);
        }
      });
      
      // Menu mobile
      if (isMobile) {
        const menuButtons = document.querySelectorAll('.mobile-menu-btn');
        const mobilePages = document.querySelectorAll('.mobile-page');
        
        menuButtons.forEach(btn => {
          btn.addEventListener('click', function() {
            const page = this.getAttribute('data-page');
            
            // Atualizar bot√µes ativos
            menuButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            // Mostrar p√°gina correspondente
            mobilePages.forEach(p => p.classList.remove('active'));
            document.getElementById('mobile' + page.charAt(0).toUpperCase() + page.slice(1) + 'Page').classList.add('active');
            
            // Mostrar/ocultar √°rea de entrada
            const chatInput = document.getElementById('mobileChatInput');
            chatInput.style.display = page === 'chat' ? 'block' : 'none';
          });
        });
      }
      
      // Tela cheia
      const fullscreenBtns = document.querySelectorAll('[id^="fullscreenBtn"]');
      fullscreenBtns.forEach(btn => {
        btn.addEventListener('click', toggleFullscreen);
      });
    }
    
    // Enviar mensagem - CORRIGIDO
    function sendMessage() {
      const messageText = messageInput.value.trim();
      
      if (messageText === '') return;
      
      // Verificar se o usu√°rio j√° entrou no chat
      if (!currentUser.online) {
        alert('Por favor, salve seu perfil primeiro!');
        return;
      }
      
      // Adicionar mensagem
      addMessage(currentUser, messageText);
      
      // Limpar campo
      messageInput.value = '';
      
      // Simular resposta
      if (users.length > 0 && Math.random() > 0.5) {
        setTimeout(() => {
          const randomUser = users[Math.floor(Math.random() * users.length)];
          const responses = [
            "Interessante!",
            "Concordo!",
            "Algu√©m mais tem experi√™ncia com esses servi√ßos?",
            "Vou considerar isso!",
            "Eu j√° usei os servi√ßos, s√£o √≥timos!"
          ];
          const randomResponse = responses[Math.floor(Math.random() * responses.length)];
          addMessage(randomUser, randomResponse);
        }, 1000);
      }
    }
    
    // Adicionar mensagem ao chat
    function addMessage(user, text) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${user.id === currentUser.id ? 'own-message' : ''}`;
      
      const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      
      messageDiv.innerHTML = `
        <img src="${user.avatar}" alt="${user.name}" class="message-avatar">
        <div class="message-content">
          <div class="message-sender">${user.name}</div>
          <div class="message-bubble">${text}</div>
          <div class="message-time">${time}</div>
        </div>
      `;
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // Adicionar mensagem de sistema
    function addSystemMessage(text) {
      const systemDiv = document.createElement('div');
      systemDiv.className = 'system-message';
      systemDiv.textContent = text;
      chatMessages.appendChild(systemDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // Salvar perfil - CORRIGIDO
    function saveProfile() {
      // Obter valores do formul√°rio correto
      let userName, userAge, userGender, userStatus, userNeighborhood;
      
      if (isMobile) {
        userName = document.getElementById('userNameMobile').value;
        userAge = document.getElementById('userAgeMobile').value;
        userGender = document.getElementById('userGenderMobile').value;
        userStatus = document.getElementById('userStatusMobile').value;
        userNeighborhood = document.getElementById('userNeighborhoodMobile').value;
      } else {
        userName = document.getElementById('userName').value;
        userAge = document.getElementById('userAge').value;
        userGender = document.getElementById('userGender').value;
        userStatus = document.getElementById('userStatus').value;
        userNeighborhood = document.getElementById('userNeighborhood').value;
      }
      
      // Atualizar usu√°rio
      currentUser = {
        ...currentUser,
        name: userName,
        age: parseInt(userAge),
        gender: userGender,
        status: userStatus,
        neighborhood: userNeighborhood,
        online: true
      };
      
      // Atualizar exibi√ß√£o
      document.querySelectorAll('.userNameDisplay').forEach(el => {
        if (el) el.textContent = currentUser.name;
      });
      
      document.querySelectorAll('.status').forEach(el => {
        if (el) {
          el.innerHTML = '<i class="fas fa-circle"></i> Online';
          el.style.color = '#2ecc71';
        }
      });
      
      // Adicionar usu√°rio √† lista
      if (!users.find(u => u.id === currentUser.id)) {
        users.push(currentUser);
      }
      
      // Atualizar lista de usu√°rios
      updateUsersList();
      
      // Salvar no localStorage
      localStorage.setItem('userProfile', JSON.stringify(currentUser));
      
      // Mensagem de entrada
      addSystemMessage(`üéâ ${currentUser.name} entrou no chat!`);
      
      // Mensagem de boas-vindas
      setTimeout(() => {
        addMessage(currentUser, "Ol√° pessoal! Acabei de entrar no chat.");
      }, 500);
      
      hasUserJoined = true;
      
      // Simular entrada de outros usu√°rios
      if (users.length === 1) {
        setTimeout(() => {
          simulateRandomUsers();
        }, 3000);
      }
    }
    
    // Atualizar lista de usu√°rios
    function updateUsersList() {
      const onlineCount = document.getElementById('onlineCount');
      if (onlineCount) {
        onlineCount.textContent = users.filter(u => u.online).length;
      }
      
      // Atualizar lista PC
      const usersListPC = document.getElementById('usersList');
      if (usersListPC) {
        usersListPC.innerHTML = '';
        
        if (users.length === 0) {
          usersListPC.innerHTML = '<div class="empty-users-message"><i class="fas fa-users-slash"></i><p>A sala est√° vazia. Seja o primeiro a entrar!</p></div>';
        } else {
          users.forEach(user => {
            const userElement = document.createElement('div');
            userElement.className = 'user-item';
            userElement.innerHTML = `
              <img src="${user.avatar}" alt="${user.name}" class="avatar">
              <div class="user-info">
                <div class="user-name">${user.name} ${user.id === currentUser.id ? '(Voc√™)' : ''}</div>
                <div class="user-status">
                  <span style="color: #2ecc71;">‚óè</span> Online | ${user.age} anos
                </div>
              </div>
            `;
            usersListPC.appendChild(userElement);
          });
        }
      }
      
      // Atualizar lista Mobile
      const usersListMobile = document.getElementById('usersListMobile');
      if (usersListMobile) {
        usersListMobile.innerHTML = '';
        
        if (users.length === 0) {
          usersListMobile.innerHTML = '<div class="empty-users-message"><i class="fas fa-users-slash"></i><p>A sala est√° vazia. Seja o primeiro a entrar!</p></div>';
        } else {
          users.forEach(user => {
            const userElement = document.createElement('div');
            userElement.className = 'user-item';
            userElement.innerHTML = `
              <img src="${user.avatar}" alt="${user.name}" class="avatar">
              <div class="user-info">
                <div class="user-name">${user.name} ${user.id === currentUser.id ? '(Voc√™)' : ''}</div>
                <div class="user-status">
                  <span style="color: #2ecc71;">‚óè</span> Online | ${user.age} anos
                </div>
              </div>
            `;
            usersListMobile.appendChild(userElement);
          });
        }
      }
    }
    
    // Simular usu√°rios aleat√≥rios
    function simulateRandomUsers() {
      const randomNames = ["Ana Silva", "Carlos Santos", "Maria Oliveira", "Jo√£o Costa", "Paula Lima"];
      const neighborhoods = ["Vila Aurora", "Jardim Ipiranga", "Vila Oper√°ria", "Jardim Novo Horizonte", "Centro"];
      
      // Adicionar 2-3 usu√°rios aleat√≥rios
      const numUsers = Math.floor(Math.random() * 2) + 2;
      
      for (let i = 0; i < numUsers; i++) {
        const name = randomNames[Math.floor(Math.random() * randomNames.length)];
        const neighborhood = neighborhoods[Math.floor(Math.random() * neighborhoods.length)];
        const gender = Math.random() > 0.5 ? "masculino" : "feminino";
        const age = Math.floor(Math.random() * 20) + 18;
        
        const newUser = {
          id: 'user_' + Math.random().toString(36).substr(2, 9),
          name: name,
          age: age,
          gender: gender,
          status: Math.random() > 0.5 ? "solteiro" : "casado",
          neighborhood: neighborhood,
          avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=${gender === "masculino" ? "007bff" : "e91e63"}&color=fff`,
          online: true
        };
        
        users.push(newUser);
        
        // Mensagem de entrada
        setTimeout(() => {
          addSystemMessage(`${name} entrou no chat.`);
        }, i * 1000);
        
        // Sauda√ß√£o do usu√°rio
        setTimeout(() => {
          const greetings = [
            "Ol√° pessoal! Tudo bem?",
            "Oi gente! Algu√©m j√° usou os servi√ßos da loja?",
            "Boa tarde! Acabei de chegar.",
            "Ol√°! Como funciona o chat?"
          ];
          const greeting = greetings[Math.floor(Math.random() * greetings.length)];
          addMessage(newUser, greeting);
        }, i * 1000 + 500);
      }
      
      updateUsersList();
    }
    
    // Carregar perfil salvo
    function loadProfile() {
      const savedProfile = localStorage.getItem('userProfile');
      if (savedProfile) {
        currentUser = JSON.parse(savedProfile);
        currentUser.online = false; // Come√ßa offline
        
        // Preencher formul√°rios
        if (isMobile) {
          if (document.getElementById('userNameMobile')) document.getElementById('userNameMobile').value = currentUser.name;
          if (document.getElementById('userAgeMobile')) document.getElementById('userAgeMobile').value = currentUser.age;
          if (document.getElementById('userGenderMobile')) document.getElementById('userGenderMobile').value = currentUser.gender;
          if (document.getElementById('userStatusMobile')) document.getElementById('userStatusMobile').value = currentUser.status;
          if (document.getElementById('userNeighborhoodMobile')) document.getElementById('userNeighborhoodMobile').value = currentUser.neighborhood;
          if (document.getElementById('userNameDisplayMobile')) document.getElementById('userNameDisplayMobile').textContent = currentUser.name;
        } else {
          if (document.getElementById('userName')) document.getElementById('userName').value = currentUser.name;
          if (document.getElementById('userAge')) document.getElementById('userAge').value = currentUser.age;
          if (document.getElementById('userGender')) document.getElementById('userGender').value = currentUser.gender;
          if (document.getElementById('userStatus')) document.getElementById('userStatus').value = currentUser.status;
          if (document.getElementById('userNeighborhood')) document.getElementById('userNeighborhood').value = currentUser.neighborhood;
          if (document.getElementById('userNameDisplay')) document.getElementById('userNameDisplay').textContent = currentUser.name;
        }
        
        // Carregar avatar
        const savedAvatar = localStorage.getItem('userAvatar');
        if (savedAvatar) {
          currentUser.avatar = savedAvatar;
          document.querySelectorAll('.profile-pic').forEach(img => {
            img.src = savedAvatar;
          });
        }
      }
    }
    
    // Anima√ß√£o do banner
    function startBannerAnimation() {
      let isVisible = true;
      const banner = isMobile ? 
        document.getElementById('servicesBannerMobile') : 
        document.getElementById('servicesBanner');
      
      setInterval(() => {
        isVisible = !isVisible;
        if (banner) {
          if (isVisible) {
            banner.classList.remove('hidden');
          } else {
            banner.classList.add('hidden');
          }
        }
      }, 10000);
    }
    
    // Tela cheia
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.error("Erro ao entrar em tela cheia:", err);
        });
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }
    
    // Configurar PWA
    function setupPWA() {
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("sw.js")
          .then(() => console.log("PWA ativo"))
          .catch(err => console.log("Erro SW", err));
      }
      
      let deferredPrompt;
      const installBtnPc = document.getElementById("installBtnPc");
      const installBtnMobile = document.getElementById("installBtnMobile");
      
      window.addEventListener("beforeinstallprompt", e => {
        e.preventDefault();
        deferredPrompt = e;
        if (installBtnPc) installBtnPc.style.display = "block";
        if (installBtnMobile) installBtnMobile.style.display = "block";
      });
      
      if (installBtnPc) {
        installBtnPc.addEventListener("click", () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(() => {
              deferredPrompt = null;
              installBtnPc.style.display = "none";
            });
          }
        });
      }
      
      if (installBtnMobile) {
        installBtnMobile.addEventListener("click", () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            deferredPrompt.userChoice.then(() => {
              deferredPrompt = null;
              installBtnMobile.style.display = "none";
            });
          }
        });
      }
    }
    
    // Redimensionamento
    window.addEventListener('resize', function() {
      const wasMobile = isMobile;
      isMobile = window.innerWidth <= 768;
      
      if (wasMobile !== isMobile) {
        setupDevice();
      }
    });
  </script>
</body>
</html>
